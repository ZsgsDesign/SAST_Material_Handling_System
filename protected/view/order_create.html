<style>
    <{include file="MHS.css" }>

    card.mhs-card > div{
        text-align: center;
        padding: 0.5rem;
    }

</style>

<div class="container mundb-standard-container"> 
<h3 class="mhs-title mb-3 mt-3">创建订单</h3>
<{foreach $order_item as $seq => $r}>
<card class="mhs-card">
    <div class="row item" iid="<{$r['item_id']}>" count="<{$r['count']}>">      
            <div class="col-xl-2 col-md-3 col-sm-4 col-5">
                    <img class="mhs-item-img-order rounded float-middle" src="<{$MHS_DOMAIN}>/pic/<{$r['item_id']}>?size=400">
            </div>
            <div class="col-xl-10 col-md-9 col-sm-8 col-7">
                    <h4 class="text-left"><a href="<{$MHS_DOMAIN}>/item/detail/<{$r['item_id']}>"><{$r['name']}></a></h4>
                    <p class="text-left">出借方：<{$r['real_name']}></p>
                    <p class="text-left">位置：<{$r['location']}></p>
                    <p class="text-left">数量：<{$r['count']}></p>
            </div>
    </div>
</card>
<{/foreach}>
<h5 class="mt-3">总计：<{count($order_item)}> 件物品，共 <{$total_count}> 个。</h5>
<script>
    let submit=function(){
        NodeList.prototype.map=Array.prototype.map;
        document.querySelectorAll('.item').map(function(val,index,arr){
            let iid=val.getAttribute('iid');
            let count=val.getAttribute('count');
            $.post('<{$MHS_DOMAIN}>/ajax/CreateOrder',{
                iid:iid,
                count:count
            },function(data,status){
                console.log(data,status);
                if(index+1 === arr.length){
                    if(arr.length === 1){
                        data=JSON.parse(data);
                        window.location.href="<{$MHS_DOMAIN}>/order/view?oid="+data.data.oid;
                    }
                    else{
                        window.location.href="<{$MHS_DOMAIN}>/orders";
                    }
                }
            })
        });
    }
</script>
<div class="text-right">
    <button type="button" class="btn btn-outline-primary mhs-button-cart" onclick="submit()">下单</button>
</div>
</div>